# GRE (Generic Routing Encapsulation)

**GRE (Generic Routing Encapsulation)** — это протокол туннелирования, который позволяет инкапсулировать различные типы сетевых протоколов внутри IP-пакетов. GRE туннели используются для создания виртуальных частных сетей (VPN), объединения удаленных сетей и обеспечения передачи данных через ненадежные сети, такие как Интернет.

*GRE туннель — это способ создания виртуального "туннеля" через Интернет или другую сеть, чтобы устройства, находящиеся в разных местах, могли общаться друг с другом, как если бы они были в одной локальной сети.*

## Особенности 

Основные особенности GRE туннеля:

- Поддержка множества протоколов: GRE позволяет инкапсулировать различные протоколы, такие как IP, IPX, AppleTalk и другие.
- Безопасность: Хотя GRE сам по себе не обеспечивает шифрование данных, его часто используют в сочетании с другими протоколами, такими как IPsec, для обеспечения безопасности.
- Прозрачность: GRE туннели прозрачны для инкапсулированных протоколов, что позволяет им работать без изменений.

## Механизм работы протокола GRE

*Для работы протокола необходим маршрут по умолчанию и маршрут то нужной подсети.*

Когда вы запускаете ping 10.1.1.0, что делает маршрутизатор?

1. Формирует IP-пакет с ip source к dest ip
2. Смотрит таблицу маршрутизации, там показывает через 10.2.2.2. Далее рекурсивно смотрит, где адрес 10.2.2.2
3. Понимая, что это GRE-туннель, добавляет к пакету заголовок GRE. А сверху новый заголовок IР. В качестве отправителя будет значиться адрес tunnel source, а в качестве получателя – tunnel destination
4. Новоиспечённый пакет отправляется в дивный мир по дефолтному маршруту
5. Не забываем про заголовок Ethernet, при отправке провайдеру он также должен быть сформирован.
6. И в таком виде новый IP-пакет передаётся в интернет. А поскольку каждый маршрутизатор не раздербанивает пакет, а принимает решение на основе первого же заголовка IP, то никто в Интернете не будет знать о том, что где-то там внутри кроются ваши приватные адреса 10.1.1.0 и 10.0.0.0.

*Поскольку GRE-туннель – виртуальный интерфейс 3-го уровня, он не обладает собственным MAC-адресом (как и Loopback, например). В конечном итоге кадр уйдёт с физического интерфейса FastEthernet0/0, Соответственно его адрес он и укажет в качестве Source MAC. Destination по традиции берётся из ARP-кэша или получается с помощью ARP-запроса от адреса 100.0.0.2.*
